<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="by.dao.RateDao">

    <resultMap id="RateMap" type="by.entity.Rate">
        <id property="id" column="id"/>
        <result property="rate" column="rate"/>
        <association property="rateResult" javaType="by.entity.RateResult">
            <id property="id" column="result_id"/>
            <result property="rateResult" column="result"/>
        </association>
        <association property="race" javaType="by.entity.Race">
        <id property="id" column="race_id"/>
        <result property="race" column="race"/>
        </association>
    </resultMap>

    <select id="getRates" resultMap="RateMap">
        select rate.id as id,
            race_id, race, rate, result_id, result
        from rate inner join race on (rate.race_id = race.id)
        inner join rate_result on rate.result_id = rate_result.id
        where race_id = #{id}
    </select>

    <select id="getRate" resultType="by.entity.Rate">
        select rate.id as rate_id,
            race_id, race, rate, result_id, result
        from rate inner join race on (rate.race_id = race.id)
            inner join rate_result on rate.result_id = rate_result.id
        where race_id = #{rateId}
    </select>

    <select id="getRateResultOfRate" resultType="java.lang.Integer">
        select result_id from rate where id =#{rateId}
    </select>

    <update id = "update" parameterType = "by.entity.Rate">
        UPDATE rate SET rate = #{rate}
        WHERE ID = #{id};
    </update>

</mapper>